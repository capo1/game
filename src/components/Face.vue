<template>
  <div class="face">
    <svg
      xmlns:dc="http://purl.org/dc/elements/1.1/"
      xmlns:cc="http://creativecommons.org/ns#"
      xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
      xmlns:svg="http://www.w3.org/2000/svg"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      id="svg7"
      version="1.1"
      viewBox="-250 -250 500 500"
    >
      <metadata id="metadata13">
        <rdf:RDF>
          <cc:Work rdf:about="">
            <dc:format>image/svg+xml</dc:format>
            <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
            <dc:title></dc:title>
          </cc:Work>
        </rdf:RDF>
      </metadata>
      <defs id="defs11">
        <linearGradient id="linearGradient4629">
          <stop
            id="stop4625"
            offset="0"
            style="stop-color:#ffd42a;stop-opacity:1;"
          />
          <stop
            id="stop4627"
            offset="1"
            style="stop-color:#ffb92a;stop-opacity:1"
          />
        </linearGradient>
        <linearGradient id="linearGradient4599">
          <stop
            style="stop-color:#ff2a2a;stop-opacity:0.66374266"
            offset="0"
            id="stop4595"
          />
          <stop
            style="stop-color:#ff2ad4;stop-opacity:0"
            offset="1"
            id="stop4597"
          />
        </linearGradient>
        <radialGradient
          gradientUnits="userSpaceOnUse"
          gradientTransform="matrix(1,0,0,0.96197144,209.0123,29.706064)"
          r="41.783897"
          fy="-9.5339041"
          fx="-104.34322"
          cy="-9.5339041"
          cx="-104.34322"
          id="radialGradient4569-5"
          xlink:href="#linearGradient4599"
        />
        <radialGradient
          gradientUnits="userSpaceOnUse"
          gradientTransform="matrix(1,0,0,0.96197144,25.876521,21.721291)"
          r="41.783897"
          fy="-9.5339041"
          fx="-104.34322"
          cy="-9.5339041"
          cx="-104.34322"
          id="radialGradient4569-5-8"
          xlink:href="#linearGradient4599"
        />
        <radialGradient
          gradientTransform="matrix(0.81648182,0,0,0.81648182,6.5756443,20.773549)"
          gradientUnits="userSpaceOnUse"
          r="200.5"
          fy="-29.661011"
          fx="3.1779633"
          cy="-29.661011"
          cx="3.1779633"
          id="radialGradient4633"
          xlink:href="#linearGradient4629"
        />
      </defs>
      <ellipse
        ry="207.09746"
        rx="212.43253"
        cy="-20.65678"
        cx="6.8471398"
        id="path4778"
        style="opacity:1;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:7.50866461;stroke-miterlimit:4;stroke-dasharray:none"
      />
      <rect
        ry="163.29636"
        style="fill:url(#radialGradient4633);fill-opacity:1;stroke:none;stroke-width:0.81648183"
        height="326.59271"
        width="326.59271"
        y="-166.74049"
        x="-154.12598"
        id="face"
      />
      <path
        style="fill: none;
    stroke: #020202;
    stroke-width: 5px;
    stroke-linecap: round;"
        id="smile"
        d="M-70 70 C-42 28.000000000000004 42 28.000000000000004 70 70"
      ></path>
      <ellipse
        ry="60.381355"
        rx="122.12265"
        cy="-36.01696"
        cx="4.5379195"
        id="path4780"
        style="opacity:1;fill:#ffc62a;fill-opacity:1;stroke:none;stroke-width:16.47434616;stroke-miterlimit:4;stroke-dasharray:none"
      />
      <ellipse
        ry="62.419922"
        rx="27.648308"
        cy="-73.342773"
        cx="-11.493052"
        id="path4637"
        style="opacity:1;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:8.02534485;stroke-miterlimit:4;stroke-dasharray:none"
      />
      <ellipse
        transform="matrix(0.97945426,0.20166642,-0.23598517,0.97175666,0,0)"
        ry="62.729206"
        rx="28.56806"
        cy="-71.764076"
        cx="20.125301"
        id="path4637-0"
        style="opacity:1;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:8.17792416;stroke-miterlimit:4;stroke-dasharray:none"
      />
      <path
        id="path4551"
        d="m 24.593914,-3.4323138 c -3.508067,-1.155868 -6.458656,-3.289445 -8.888247,-6.427083 -0.879107,-1.1353092 -0.639835,-0.9798702 1.120268,0.727777 4.891784,4.74595 10.182068,5.73584 16.078972,3.008589 12.746347,-5.8950352 24.545478,-27.9904402 29.031537,-54.3653432 1.342989,-7.895855 1.765991,-14.278175 1.548346,-23.363409 -0.291303,-12.161569 -1.774029,-19.405207 -5.540007,-27.064717 -1.69686,-3.45118 -2.403864,-4.46956 -4.563929,-6.5739 -3.662344,-3.56788 -5.240792,-4.25768 -9.742577,-4.25768 -3.29871,0 -3.792681,0.0934 -6.025778,1.13876 -7.11403,3.33041 -14.126952,11.61726 -19.565725,23.119926 l -1.619677,3.425501 0.490134,4.447036 c 0.63851,5.793201 0.641235,23.321304 0.005,28.59579 -0.6631,5.492556 -1.396956,10.100516 -2.234022,14.027583 -0.827416,3.881772 -2.530301,10.022699 -2.725757,9.829527 -0.07276,-0.07191 0.357484,-2.15631 0.956128,-4.631986 8.194069,-33.886461 -0.146351,-76.137847 -16.9154997,-85.691607 -8.7666853,-4.99457 -18.2270483,0.27925 -24.9476673,13.90743 -3.934957,7.97937 -6.879746,19.581449 -8.112349,31.961586 -0.601619,6.042594 -0.505384,18.827644 0.189418,25.165459 2.492684,22.737524 10.41254,39.961662 20.558617,44.710972 2.202095,1.030785 2.788837,1.14932 5.689259,1.14932 2.8205277,0 3.4979162,-0.12811 5.2988353,-1.002121 1.1356939,-0.551174 2.9952189,-1.721831 4.1322747,-2.601477 l 2.0673687,-1.599354 -1.9762976,1.812356 c -2.3710351,2.174336 -6.2222707,4.1419342 -9.1289321,4.6639742 -4.728568,0.849264 -9.398982,-0.9890382 -14.062157,-5.5349222 -5.883152,-5.735184 -10.516874,-14.756787 -13.61004,-26.49797 -7.322874,-27.796559 -5.026471,-61.951083 5.593963,-83.199513 2.536076,-5.07394 4.713555,-8.1751 8.005914,-11.40198 5.995838,-5.87661 11.831022,-7.18699 18.3778374,-4.12701 8.9764672,4.19559 16.4238406,17.28718 20.5824186,36.18142 l 0.958266,4.353808 1.383592,-3.288418 c 6.078095,-14.44606 15.10013,-25.77779 23.484254,-29.4964 14.00004,-6.20942 25.251421,6.3859 28.32871,31.71247 0.645523,5.312872 0.728644,18.217957 0.156627,24.326317 -3.234779,34.544203 -18.682566,66.22002 -35.210255,72.1989092 -2.853105,1.032096 -7.109618,1.3387 -9.168273,0.66038 z M 13.993756,-12.190865 c -0.211545,-0.390643 -0.303766,-0.710257 -0.204957,-0.710257 0.09875,0 0.352746,0.319614 0.564278,0.710257 0.211545,0.390644 0.303767,0.710258 0.204957,0.710258 -0.09875,0 -0.352746,-0.319614 -0.564278,-0.710258 z m 15.193014,-9.072419 c -4.450605,-2.191917 -7.262694,-8.413955 -7.331438,-16.221559 -0.06788,-7.708072 2.811526,-14.190963 7.280484,-16.391914 2.374647,-1.169506 3.983436,-1.174042 6.331031,-0.01787 2.354571,1.159623 3.862688,2.864358 5.313424,6.006159 1.642492,3.557044 2.114923,5.859194 2.114923,10.305879 0,4.446697 -0.472431,6.748834 -2.114923,10.305891 -1.450736,3.141801 -2.958853,4.846533 -5.313424,6.006157 -2.335169,1.150062 -3.955821,1.151927 -6.280077,0.0074 z m -44.529167,-1.921143 c -2.806676,-0.659169 -5.104166,-2.918125 -6.965029,-6.848243 -3.600375,-7.603919 -2.522174,-18.826965 2.338557,-24.341981 5.094841,-5.780655 11.9869501,-3.394658 15.3328396,5.308118 2.2425599,5.833 1.8353475,14.390139 -0.9426511,19.808194 -2.2960034,4.477992 -6.2049705,6.909722 -9.7637165,6.073912 z m 23.478928,-3.332576 c -0.1016346,-0.261866 -0.040625,-0.701337 0.135725,-0.976596 0.2333103,-0.364253 0.3220806,-0.234636 0.3260814,0.476116 0.00627,1.060487 -0.170216,1.251447 -0.4618064,0.50048 z m 2.320468,-6.44889 c -0.0011,-0.195322 0.216095,-0.914462 0.48247,-1.598082 0.266376,-0.68362 0.489321,-1.003234 0.495447,-0.710257 0.0063,0.292976 -0.210995,1.012117 -0.48247,1.598082 -0.271476,0.585965 -0.494434,0.905579 -0.495447,0.710257 z m 89.267742,-93.753987 c -0.951963,-14.6047 -5.399119,-26.00272 -13.105717,-33.58982 -3.963922,-3.90247 -7.47754,-5.94579 -13.156573,-7.65112 -3.210951,-0.96421 -10.128975,-0.87118 -14.193432,0.19087 -5.761603,1.50553 -12.694079,5.3343 -17.318026,9.56467 -1.915655,1.7526 -2.121523,1.86604 -1.609213,0.88664 1.169222,-2.23525 4.958728,-6.83228 7.890703,-9.57215 5.16366,-4.82537 10.450619,-7.84902 16.450482,-9.40815 3.826734,-0.99442 9.773467,-1.06226 13.271083,-0.15138 10.103536,2.63123 17.867639,10.47265 21.857752,22.07535 2.91723,8.48297 3.18185,20.54539 0.6534,29.78586 l -0.485847,1.77564 z m -155.799861,3.13168 c 0,-0.19823 -0.319618,-1.86289 -0.710255,-3.69925 -1.644404,-7.7303 -1.699171,-15.22523 -0.164978,-22.57517 1.280408,-6.13408 4.244699,-12.57038 7.823447,-16.98681 11.723851,-14.46812 31.189991,-14.29435 46.0694749,0.41127 2.26309987,2.23664 6.1192732,7.03186 7.0632619,8.78326 0.3775235,0.70045 0.3590961,0.71485 -0.2839136,0.22192 -0.3782105,-0.28994 -1.4790642,-1.21403 -2.446342,-2.05355 -4.2750885,-3.71046 -10.4098274,-7.06692 -15.6903982,-8.5846 -3.673369,-1.05576 -10.05118,-1.34562 -13.517081,-0.61432 -5.224215,1.10228 -9.450337,3.28614 -13.517918,6.98538 -8.104524,7.37063 -12.7798,18.45568 -13.929608,33.02698 -0.223484,2.83215 -0.471444,5.21595 -0.551015,5.29734 -0.07963,0.0814 -0.144675,-0.0142 -0.144675,-0.21245 z"
        style="fill:#000000;stroke-width:0.35722202"
      />
      <path
        d="M -11.368127,15.1622 C -7.6824471,11.23761 -4.0004911,6.9015582 1.1410836,4.8923182 1.847584,4.6162862 2.5871539,4.4338222 3.3101897,4.2045902 c 0.9231914,-0.09212 1.8418115,-0.27011 2.7695555,-0.276374 5.9930378,-0.04051 12.4501078,2.264303 18.0427038,4.25654 3.57647,1.62963 1.884718,0.776289 5.088998,2.5326688 0,0 -5.786083,6.043981 -5.786083,6.043981 v 0 C 20.38116,14.965132 21.994468,15.835785 18.569647,14.178868 12.919474,12.026801 6.8849673,9.8443062 0.72830304,10.303997 c -0.9166495,0.06845 -1.81081154,0.317383 -2.71621974,0.476082 -1.9793054,0.75939 -3.6676614,1.496272 -5.4202384,2.704688 -0.453382,0.312611 -1.686132,1.407513 -1.313648,1.001888 1.450735,-1.579883 7.2925109,-7.3519648 4.543077,-4.5570318 0,0 -7.1894009,5.2325768 -7.1894009,5.2325768 z"
        id="path4557"
        style="opacity:1;fill:#000000;fill-opacity:1;stroke:none;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none"
      />
      <ellipse
        ry="39.194916"
        rx="40.783897"
        cy="20.534721"
        cx="104.66908"
        id="path4559-6"
        style="opacity:1;fill:url(#radialGradient4569-5);fill-opacity:1;stroke:none;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none"
      />
      <ellipse
        ry="39.194916"
        rx="40.783897"
        cy="12.549946"
        cx="-78.466682"
        id="path4559-6-5"
        style="opacity:1;fill:url(#radialGradient4569-5-8);fill-opacity:1;stroke:none;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none"
      />
    </svg>
  </div>
</template>

<script>
export default {
  name: "Face",
  data() {
    return {
      rID: null,
      f: 0,
      dir: -1,
      NF: 32,
      FACE: null,
      MOUTH: null,
      RMAX: 0,
      DATA: [],
      CPY_INI: 0,
      CPY_RANGE: 0,
    };
  },
  mounted() {
    this.FACE = document.getElementById("face");
    this.MOUTH = document.getElementById("smile");
    this.RMAX = 0.5 * this.FACE.getAttribute("width");
    this.DATA = this.MOUTH.getAttribute("d")
      .replace(/M|C/g, "")
      .trim(/* Edge */)
      .split(/\s+/)
      .map((c) => +c);
    this.CPY_INI = this.DATA[3];
    this.CPY_RANGE = 2 * (this.DATA[1] - this.DATA[3]);
    this.$parent.$on("update", this.setSmiel);
  },
  methods: {
    stopAni() {
      cancelAnimationFrame(this.rID);
      let th = this;
      th.rID = null;
      return true;
    },
    setSmiel(val) {
      if(this.dir == val) return;
      this.dir = val;
      this.updateAnim();
    },
    updateAnim() {
      let th = this;
      th.f += th.dir;
      let cpy = th.CPY_INI + th.timing() * th.CPY_RANGE;
      th.FACE.setAttribute("rx", (200).toFixed(2));
      th.MOUTH.setAttribute(
        "d",
        `M${th.DATA.slice(0, 2)}
		 C${th.DATA[2]} ${cpy}
		 ${th.DATA[4]} ${cpy}
		 ${th.DATA.slice(-2)}`
      );
      if (!(th.f % th.NF)) {
        th.stopAni();
        return true;
      }
      let el = document.getElementById("smile");
      if (th.timing() * th.RMAX < -200) {
        el.style.opacity = 0;
      } else {
        el.style.opacity = 1;
      }
      th.rID = requestAnimationFrame(th.updateAnim);
    },
    timing() {
      return 1 - Math.pow(1 - this.f / this.NF, 2);
    },
  },
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
svg {
  max-width: 20em;
  width: 80vmin;
  margin-left: -300px;
}

[x] {
  fill: gold;
  stroke: currentcolor;
  cursor: pointer;
}

[d] {
  fill: none;
  stroke: currentcolor;
  stroke-width: 5px;
  stroke-linecap: round;
}
</style>
